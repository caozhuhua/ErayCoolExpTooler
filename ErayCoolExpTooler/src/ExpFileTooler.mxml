<?xml version="1.0" encoding="utf-8"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009" 
					   xmlns:s="library://ns.adobe.com/flex/spark"  showStatusBar="false" creationComplete="initWindowHandler(event)"
					   xmlns:mx="library://ns.adobe.com/flex/mx" minWidth="1100" minHeight="700" maxWidth="1100" maxHeight="700">
	<fx:Script>
		<![CDATA[
			import com.coolexp.manager.AnimationPackager;
			import com.coolexp.manager.FilePackManager;
			
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.utils.StringUtil;
			
			private var pckType:int;
			protected function initWindowHandler(event:FlexEvent):void
			{
				// TODO Auto-generated method stub
				
			}
			
			protected function packInitGameRes(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				var file:File = new File();
				file.addEventListener(Event.SELECT,onSelectFolder);
				file.browseForDirectory("选择资源文件夹");
			}
			
			protected function onSelectFolder(event:Event):void
			{
				// TODO Auto-generated method stub
				var file:File = File(event.target);
				if(file){
					var fileName:String = StringUtil.trim(gfileName.text);
					file.removeEventListener(Event.SELECT,onSelectFolder);
					FilePackManager.getInstance().packGameRes(file,StringUtil.trim(gfileName.text));
					Alert.show(fileName+"打包成功","信息");
				}
			}
			private function packageFileHandler(val:int):void{
				var file:File = new File();
				file.addEventListener(Event.SELECT,onSelectFileHandler);
				if(val==1){
					file.browse();
				}else if(val==2){
					file.browseForDirectory("选择文件夹");
				}
			}
			
			protected function onSelectFileHandler(event:Event):void
			{
				// TODO Auto-generated method stub
				var file:File = File(event.target);
				if(file){
					file.removeEventListener(Event.SELECT,onSelectFileHandler);
					FilePackManager.getInstance().encode(file,selectCK.selected);
				}
			}
			private function reNameFileHandler(val:int):void{
				var file:File = new File();
				file.addEventListener(Event.SELECT,onSelecReNameHandler);
				if(pckType==2){
					file.browseForDirectory("选择文件夹");
				}else{
					file.browse();
				}
			}
			private function packAnimation(val:int):void{
				var file:File = new File();
				pckType = val;
				file.addEventListener(Event.SELECT,onSelectAnimHandler);
				if(pckType==2){
					file.browseForDirectory("选择文件夹");
				}else{
					file.browse([new FileFilter("动画文件","*.swf")]);
				}
			}
			
			protected function onSelectAnimHandler(event:Event):void
			{
				// TODO Auto-generated method stub
				var file:File = event.target as File;
				if(file){
					file.removeEventListener(Event.SELECT,onSelectAnimHandler);
					AnimationPackager.getInstance().packAnimationFile(file,pckType,selectACK.selected);
				}
			}
			
			protected function onSelecReNameHandler(event:Event):void
			{
				// TODO Auto-generated method stub
				var file:File = event.target as File;
				if(file){
					file.removeEventListener(Event.SELECT,onSelecReNameHandler);
					FilePackManager.getInstance().rename(file,StringUtil.trim(extName.text));
				}
			}
			protected function unEncode():void{
				var file:File = new File();
				file.addEventListener(Event.SELECT,onSelectUNEnHandler);
				file.browse();
			}
			
			protected function onSelectUNEnHandler(event:Event):void
			{
				// TODO Auto-generated method stub
				var file:File = event.target as File;
				if(file){
					file.removeEventListener(Event.SELECT,onSelectUNEnHandler);
					FilePackManager.getInstance().unEncode(file,selectAAACK.selected);
				}
			}
			
		]]>
	</fx:Script>
	
	<s:Panel width="200" height="100" title="打包游戏初始化资源">
		<s:TextInput x="10" y="10" width="180" text="GameResdata.dat" id="gfileName" />
		<s:Button x="120" y="40" click="packInitGameRes(event)" label="打包" />
	</s:Panel>
	<s:Panel x="240" width="200" height="100" title="加密文件">
		<s:CheckBox label="删除源文件"   y="10" x="20" id="selectCK" selected="true" />
		<s:Button x="20" y="40" click="packageFileHandler(1)" label="单个文件" />
		<s:Button x="120" y="40" click="packageFileHandler(2)" label="多个文件" />
	</s:Panel>
	<s:Panel x="460" width="200" height="100" title="重命名文件">
		<s:TextInput x="20" y="10" width="80" text=".dat" id="extName" />
		<s:Button x="20" y="40" click="reNameFileHandler(1)" label="单文件" />
		<s:Button x="120" y="40" click="reNameFileHandler(2)" label="多文件" />
	</s:Panel>
	<s:Panel x="680" width="200" height="100" title="打包动画">
		<s:CheckBox label="删除源文件"   y="10" x="20" id="selectACK" selected="true" />
		<s:Button x="20" y="40" click="packAnimation(1)" label="单文件" />
		<s:Button x="120" y="40" click="packAnimation(2)" label="多文件" />
	</s:Panel>
	<s:Panel width="200" height="100" y="110" title="解密资源">
		<s:CheckBox label="删除源文件"   y="10" x="20" id="selectAAACK" selected="true" />
		<s:Button x="120" y="40" click="unEncode()" label="选择" />
	</s:Panel>
</s:WindowedApplication>
